{% extends "base.html" %}

{% block title %}ê´€ì‹¬ ë§¤ë¬¼ - Rent Radar{% endblock %}

{% block content %}
<div class="container">
    <h1>â¤ï¸ ê´€ì‹¬ ë§¤ë¬¼</h1>

    {% if favorites %}
        <div class="results-header">
            <p>ì´ {{ favorites | length }}ê°œì˜ ê´€ì‹¬ ë§¤ë¬¼ì´ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="favorites-grid">
            {% for fav in favorites %}
            <div class="listing-card">
                <div class="listing-header">
                    <h3>{{ fav.apt_name }}</h3>
                    <div class="listing-meta">
                        <span class="badge">{{ fav.rent_type }}</span>
                        <span class="badge">{{ fav.source }}</span>
                        <span class="location">{{ fav.dong }}</span>
                    </div>
                    <button class="remove-fav-btn" data-id="{{ fav.id }}">ğŸ—‘ï¸</button>
                </div>
                <div class="listing-details">
                    <div class="detail-row">
                        <span>ë³´ì¦ê¸ˆ:</span>
                        <span class="price">{{ "{:,}".format(fav.deposit) }}ë§Œì›</span>
                    </div>
                    {% if fav.monthly_rent > 0 %}
                    <div class="detail-row">
                        <span>ì›”ì„¸:</span>
                        <span class="price">{{ "{:,}".format(fav.monthly_rent) }}ë§Œì›</span>
                    </div>
                    {% endif %}
                    <div class="detail-row">
                        <span>ë©´ì :</span>
                        <span class="value">{{ fav.area_m2 }}ã¡</span>
                    </div>
                    <div class="detail-row">
                        <span>ì¸µ:</span>
                        <span class="value">{{ fav.floor }}ì¸µ</span>
                    </div>
                    <div class="detail-row">
                        <span>ê³„ì•½ì¼:</span>
                        <span class="value">
                            {{ fav.contract_year }}.{{ "{:02d}".format(fav.contract_month) }}.{{ "{:02d}".format(fav.contract_day) }}
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-results">
            <p>ê´€ì‹¬ ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p>ë§¤ë¬¼ ëª©ë¡ì—ì„œ ë§¤ë¬¼ì„ ì¶”ê°€í•˜ê³  ê´€ì‹¬ ë§¤ë¬¼ì„ ìƒì„±í•˜ì„¸ìš”.</p>
        </div>
    {% endif %}

    <script>
        // Remove from favorites
        document.querySelectorAll('.remove-fav-btn').forEach(function(btn) {
            btn.addEventListener('click', async function(e) {
                e.preventDefault();
                const id = this.dataset.id;

                if (confirm('ê´€ì‹¬ ë§¤ë¬¼ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        const response = await fetch(`/web/favorites/${id}`, {
                            method: 'POST',
                        });

                        if (response.ok) {
                            location.reload();
                        }
                    } catch (err) {
                        console.error('Remove favorite failed:', err);
                        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            });
        });
    </script>
{% endblock %}
